<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaFo - –ê–¥–º–∏–Ω –ü–∞–Ω–µ–ª—å</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        @keyframes terminal-glow {
            0%, 100% {
                text-shadow: 0 0 5px #00ff00, 0 0 10px #00ff00, 0 0 15px #00ff00;
                border-color: #00ff00;
            }
            50% {
                text-shadow: 0 0 10px #00ff00, 0 0 20px #00ff00, 0 0 30px #00ff00;
                border-color: #00ff41;
            }
        }

        @keyframes data-stream {
            0% { transform: translateY(10px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }

        @keyframes hack-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0d1117 0%, #1a1e29 100%);
            color: #c9d1d9;
            min-height: 100vh;
        }

        .terminal-border {
            border: 1px solid #00ff00;
            box-shadow: 0 0 10px #00ff00;
        }

        .hack-text {
            color: #00ff00;
            animation: terminal-glow 1s infinite alternate;
        }
        
        .loading-animation::after {
            content: '';
            animation: blink 1s infinite steps(1);
        }

        .table-row-enter {
            animation: data-stream 0.5s ease-out;
        }
    </style>
</head>
<body class="p-6">
    <div class="max-w-7xl mx-auto space-y-8">

        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Å—Ç–∞—Ç—É—Å -->
        <div class="terminal-border p-4 bg-black bg-opacity-80">
            <h1 class="text-3xl font-bold hack-text">TaFo - –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨</h1>
            <p class="text-sm mt-2">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä.  –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã: <span class="status-online font-bold text-green-500">–û–ù–õ–ê–ô–ù</span></p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            <!-- –ë–ª–æ–∫ —Å—Ç–∞—Ç—É—Å–∞ -->
            <div class="terminal-border bg-black bg-opacity-80">
                <div class="p-4 border-b border-green-400">
                    <h2 class="text-xl font-bold hack-text">‚îå‚îÄ –°–¢–ê–¢–£–° –°–ò–°–¢–ï–ú–´ ‚îÄ‚îê</h2>
                </div>
                <div class="p-4 text-sm space-y-2">
                    <div class="flex justify-between">
                        <span>–°–µ—Ä–≤–µ—Ä:</span>
                        <span class="status-online font-bold text-green-500">–†–ê–ë–û–¢–ê–ï–¢</span>
                    </div>
                    <div class="flex justify-between">
                        <span>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:</span>
                        <span class="status-online font-bold text-green-500">–ê–ö–¢–ò–í–ù–û</span>
                    </div>
                    <div class="flex justify-between">
                        <span>–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ:</span>
                        <span class="status-online font-bold text-green-500">–ê–ö–¢–ò–í–ù–û</span>
                    </div>
                    <div class="flex justify-between">
                        <span>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:</span>
                        <span id="lastUpdate" class="text-gray-400">–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</span>
                    </div>
                </div>
            </div>

            <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
            <div class="terminal-border bg-black bg-opacity-80">
                <div class="p-4 border-b border-green-400">
                    <h2 class="text-xl font-bold hack-text">‚îå‚îÄ –ë–´–°–¢–†–´–ï –î–ï–ô–°–¢–í–ò–Ø ‚îÄ‚îê</h2>
                </div>
                <div class="p-4 space-y-3">
                    <button id="refresh-button" onclick="refreshData()" class="w-full bg-green-700 hover:bg-green-600 text-black font-bold py-2 px-4 text-xs terminal-border transition-all">
                        üîÑ –û–ë–ù–û–í–ò–¢–¨ –î–ê–ù–ù–´–ï
                    </button>
                    <button onclick="exportData()" class="w-full bg-blue-700 hover:bg-blue-600 text-black font-bold py-2 px-4 text-xs terminal-border transition-all">
                        üìä –≠–ö–°–ü–û–†–¢ –ë–ê–ó–´ –î–ê–ù–ù–´–•
                    </button>
                    <button onclick="clearCache()" class="w-full bg-yellow-700 hover:bg-yellow-600 text-black font-bold py-2 px-4 text-xs terminal-border transition-all">
                        üóëÔ∏è –û–ß–ò–°–¢–ò–¢–¨ –ö–≠–®
                    </button>
                    <a href="{{ url_for('admin_logout') }}" class="block w-full text-center bg-red-700 hover:bg-red-600 text-black font-bold py-2 px-4 text-xs terminal-border transition-all">
                        üö™ –í–´–ô–¢–ò
                    </a>
                </div>
            </div>

            <!-- –ü—Ä–∏–º–µ—á–∞–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
            <div class="terminal-border bg-black bg-opacity-80">
                <div class="p-4 border-b border-green-400">
                    <h2 class="text-xl font-bold hack-text">‚îå‚îÄ –ü–†–ò–ú–ï–ß–ê–ù–ò–Ø –ê–î–ú–ò–ù–ê ‚îÄ‚îê</h2>
                </div>
                <div class="p-4 space-y-2">
                    <textarea id="admin-notes-textarea" class="w-full h-32 p-2 bg-black bg-opacity-60 terminal-border text-green-400 text-sm focus:outline-none focus:ring-1 focus:ring-green-400 resize-none"></textarea>
                    <button onclick="saveNotes()" class="w-full bg-indigo-700 hover:bg-indigo-600 text-black font-bold py-2 px-4 text-xs terminal-border transition-all">
                        üíæ –°–û–•–†–ê–ù–ò–¢–¨ –ü–†–ò–ú–ï–ß–ê–ù–ò–Ø
                    </button>
                    <p id="notes-status" class="text-xs text-center text-gray-400 mt-2"></p>
                </div>
            </div>
        </div>

        <div id="data-status-message" class="mt-4 font-bold text-sm text-yellow-400 h-6 loading-animation">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>

        <!-- –¢–∞–±–ª–∏—Ü—ã –¥–∞–Ω–Ω—ã—Ö -->
        <div class="space-y-8">
            <!-- –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
            <div class="terminal-border bg-black bg-opacity-80 p-4">
                <h2 class="text-xl font-bold hack-text">‚îå‚îÄ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ò ‚îÄ‚îê</h2>
                <div class="mt-4 overflow-x-auto">
                    <table id="users-table" class="min-w-full text-sm text-green-400">
                        <thead>
                            <tr class="text-left text-gray-400">
                                <th class="py-2 px-4 font-normal">UID</th>
                                <th class="py-2 px-4 font-normal">–ü–æ—á—Ç–∞</th>
                                <th class="py-2 px-4 font-normal">–ü–∞—Ä–æ–ª—å</th>
                                <th class="py-2 px-4 font-normal">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</th>
                                <th class="py-2 px-4 font-normal">IP</th>
                                <th class="py-2 px-4 font-normal">–ì–æ—Ä–æ–¥</th>
                            </tr>
                        </thead>
                        <tbody id="users-table-body">
                            <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω—ã —Å—é–¥–∞ -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- –¢–∞–±–ª–∏—Ü–∞ —Å–æ–∫—Ä–æ–≤–∏—â -->
            <div class="terminal-border bg-black bg-opacity-80 p-4">
                <h2 class="text-xl font-bold hack-text">‚îå‚îÄ –°–û–ö–†–û–í–ò–©–ê ‚îÄ‚îê</h2>
                <div class="mt-4 overflow-x-auto">
                    <table id="treasures-table" class="min-w-full text-sm text-green-400">
                        <thead>
                            <tr class="text-left text-gray-400">
                                <th class="py-2 px-4 font-normal">UID</th>
                                <th class="py-2 px-4 font-normal">–¢–∏–ø</th>
                                <th class="py-2 px-4 font-normal">–î–∞—Ç–∞</th>
                                <th class="py-2 px-4 font-normal">IP</th>
                            </tr>
                        </thead>
                        <tbody id="treasures-table-body">
                            <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω—ã —Å—é–¥–∞ -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        const statusMessage = document.getElementById('data-status-message');
        const usersTableBody = document.getElementById('users-table-body');
        const treasuresTableBody = document.getElementById('treasures-table-body');
        const refreshButton = document.getElementById('refresh-button');
        const notesTextarea = document.getElementById('admin-notes-textarea');
        const notesStatus = document.getElementById('notes-status');

        async function refreshData() {
            statusMessage.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...';
            statusMessage.className = 'mt-4 font-bold text-sm text-yellow-400 h-6 loading-animation';
            refreshButton.disabled = true;

            try {
                const response = await fetch('/admin/get_data');
                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${response.status}`);
                }
                const data = await response.json();
                
                if (data.success) {
                    displayUsers(data.users);
                    displayTreasures(data.treasures);
                    document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString('ru-RU');
                    notesTextarea.value = data.admin_notes || '';
                    statusMessage.textContent = '–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã.';
                    statusMessage.className = 'mt-4 font-bold text-sm text-green-500 h-6';
                } else {
                    statusMessage.textContent = '–û—à–∏–±–∫–∞: ' + (data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
                    statusMessage.className = 'mt-4 font-bold text-sm text-red-500 h-6';
                }
            } catch (error) {
                statusMessage.textContent = `–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}`;
                statusMessage.className = 'mt-4 font-bold text-sm text-red-500 h-6';
            } finally {
                refreshButton.disabled = false;
            }
        }

        function displayUsers(users) {
            usersTableBody.innerHTML = '';
            users.forEach(user => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-700 table-row-enter';
                row.innerHTML = `
                    <td class="py-2 px-4">${user.uid}</td>
                    <td class="py-2 px-4">${user.email}</td>
                    <td class="py-2 px-4">${user.password}</td>
                    <td class="py-2 px-4">${user.registration_date}</td>
                    <td class="py-2 px-4">${user.ip}</td>
                    <td class="py-2 px-4">${user.location}</td>
                `;
                usersTableBody.appendChild(row);
            });
        }

        function displayTreasures(treasures) {
            treasuresTableBody.innerHTML = '';
            treasures.forEach(treasure => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-700 table-row-enter';
                row.innerHTML = `
                    <td class="py-2 px-4">${treasure.uid}</td>
                    <td class="py-2 px-4">${treasure.treasure_type}</td>
                    <td class="py-2 px-4">${treasure.claim_date}</td>
                    <td class="py-2 px-4">${treasure.ip}</td>
                `;
                treasuresTableBody.appendChild(row);
            });
        }

        async function saveNotes() {
            notesStatus.textContent = '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...';
            const notes = notesTextarea.value;
            const formData = new FormData();
            formData.append('notes', notes);

            try {
                const response = await fetch('/admin/update_notes', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                if (result.success) {
                    notesStatus.textContent = '–ü—Ä–∏–º–µ—á–∞–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!';
                    notesStatus.className = 'mt-2 text-xs text-green-500';
                } else {
                    notesStatus.textContent = '–û—à–∏–±–∫–∞: ' + (result.error || '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å');
                    notesStatus.className = 'mt-2 text-xs text-red-500';
                }
            } catch (error) {
                notesStatus.textContent = '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏.';
                notesStatus.className = 'mt-2 text-xs text-red-500';
            }
            setTimeout(() => notesStatus.textContent = '', 3000);
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', refreshData);

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –∏ –æ—á–∏—Å—Ç–∫–∏ –∫—ç—à–∞
        function exportData() {
            // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö
            alert('–§—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.');
        }

        function clearCache() {
            // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ –∫—ç—à–∞
            alert('–§—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ –∫—ç—à–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.');
        }
    </script>
</body>
</html>
